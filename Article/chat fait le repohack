Voici un **guide clair et structur√©** des √©tapes √† suivre üëá

---

## üß© 1. Pr√©-requis

Avant tout, installe les outils de base :

```bash
sudo apt update
sudo apt install -y docker.io nextflow
sudo systemctl start docker
sudo systemctl enable docker
```

> V√©rifie l‚Äôinstallation :

```bash
docker --version
nextflow -version
```

---

## üß± 2. Trouver ou cr√©er les images Docker

### Option A ‚Äî Utiliser des images existantes sur Docker Hub ou Biocontainers

De nombreux outils bioinfo sont d√©j√† disponibles sous forme d‚Äôimages officielles.

| Logiciel      | Image Docker recommand√©e                          |
| ------------- | ------------------------------------------------- |
| SRA Toolkit   | `quay.io/biocontainers/sra-tools:<tag>`           |
| Trim Galore   | `quay.io/biocontainers/trim-galore:<tag>`         |
| Bowtie2       | `quay.io/biocontainers/bowtie2:<tag>`             |
| FeatureCounts | `quay.io/biocontainers/subread:<tag>`             |
| R + DESeq2    | `rocker/tidyverse` ou `bioconductor/deseq2:<tag>` |

üîé Exemple de recherche :

```bash
docker search sra-tools
docker pull quay.io/biocontainers/sra-tools:3.0.5--hfca6b52_2
```

### Option B ‚Äî Construire tes propres images

Si tu veux ma√Ætriser les versions ou les d√©pendances :

* Cr√©e un `Dockerfile` pour chaque outil.
* Exemple minimal pour TrimGalore :

```dockerfile
FROM ubuntu:22.04
RUN apt-get update && apt-get install -y trim-galore
ENTRYPOINT ["trim_galore"]
```

Puis :

```bash
docker build -t my_trim_galore .
```

---

## üß¨ 3. Tester chaque container individuellement

Ex√©cute un test simple :

```bash
docker run --rm quay.io/biocontainers/trim-galore:<tag> trim_galore --version
docker run --rm quay.io/biocontainers/bowtie2:<tag> bowtie2 --version
```

Tu dois obtenir la version ou un message d‚Äôaide, sinon corrige le container.

---

## ‚öôÔ∏è 4. D√©finir ton pipeline Nextflow

Cr√©e un fichier `main.nf` :

```groovy
nextflow.enable.dsl=2

process DOWNLOAD_SRA {
    container 'quay.io/biocontainers/sra-tools:3.0.5--hfca6b52_2'
    input:
    val accession_id
    output:
    path 'reads.fastq'

    """
    fasterq-dump $accession_id -O ./
    """
}

process TRIM {
    container 'quay.io/biocontainers/trim-galore:0.6.7--hdfd78af_0'
    input:
    path reads
    output:
    path 'trimmed.fastq.gz'

    """
    trim_galore $reads
    """
}

process ALIGN {
    container 'quay.io/biocontainers/bowtie2:2.5.1--py39hbc8fefb_0'
    input:
    path trimmed
    output:
    path 'aligned.sam'

    """
    bowtie2 -x genome_index -U $trimmed -S aligned.sam
    """
}

process COUNT {
    container 'quay.io/biocontainers/subread:2.0.6--hed695b0_0'
    input:
    path sam
    output:
    path 'counts.txt'

    """
    featureCounts -a annotation.gtf -o counts.txt $sam
    """
}

process DESEQ2 {
    container 'bioconductor/deseq2:latest'
    input:
    path 'counts.txt'
    output:
    path 'deseq2_results.csv'

    """
    Rscript -e "library(DESeq2); counts <- read.table('counts.txt'); \
                # ... analyse DESeq2 ...
                write.csv(results, 'deseq2_results.csv')"
    """
}

workflow {
    take: ACCESSION_ID

    main:
        reads = DOWNLOAD_SRA(ACCESSION_ID)
        trimmed = TRIM(reads)
        sam = ALIGN(trimmed)
        counts = COUNT(sam)
        DESEQ2(counts)
}
```

---

## üöÄ 5. Lancer le workflow

```bash
nextflow run main.nf --ACCESSION_ID SRR123456 --docker
```

---

## üß∞ 6. (Optionnel) Cr√©er une image unique pour tout le pipeline

Pour √©viter de changer d‚Äôimage √† chaque √©tape, tu peux construire une seule image contenant tous les outils :

```dockerfile
FROM ubuntu:22.04
RUN apt-get update && apt-get install -y sra-toolkit bowtie2 subread trim-galore r-base
RUN R -e 'install.packages("DESeq2", repos="https://cloud.r-project.org")'
```

Puis :

```bash
docker build -t my_rnaseq_pipeline .
```

Et dans Nextflow :

```groovy
container 'my_rnaseq_pipeline:latest'
```
